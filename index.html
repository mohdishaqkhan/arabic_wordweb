<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic WordWeb</title>

    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Inter font from Google Fonts for better typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- FontAwesome for the search icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Basic styling for the body to ensure full height and centering */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f4f8;
        }

        /* Responsive layout for the main container */
        .main-container {
            width: 100%;
            max-width: 800px;
            padding: 1.5rem;
        }

        /* Basic card styling with shadow and rounded corners */
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        /* Styles for the loading animation */
        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="app-container" class="main-container">
        <!-- The main application content will be rendered here -->
    </div>

    <!-- The main application script -->
    <script type="module">
        // A simple state object to manage the application's UI
        const state = {
            loading: false,
            initialLoad: true,
            error: null,
            content: null,
        };

        const appContainer = document.getElementById('app-container');

        // IMPORTANT: Replace this with your actual API key.
        const API_KEY = "AIzaSyDgKgG3__XCgA9d1tkaIa-oM1aCPT_eShE";

        // Function to render the UI based on the current state
        function render() {
            if (state.error) {
                appContainer.innerHTML = `
                    <div class="card p-8 text-center text-red-500">
                        <h2 class="text-2xl font-bold mb-4">Error</h2>
                        <p class="text-md">${state.error}</p>
                    </div>
                `;
            } else if (state.loading) {
                appContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64">
                        <div class="loader"></div>
                        <p class="mt-4 text-gray-600">Loading...</p>
                    </div>
                `;
            } else {
                appContainer.innerHTML = `
                    <div class="card">
                        <div class="flex flex-col items-center">
                            <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6">Arabic WordWeb</h1>
                            <p class="text-center text-gray-600 mb-8">
                                Enter an Arabic word below to find its root, translation, and more.
                            </p>
                            <div class="w-full relative">
                                <input
                                    id="arabic-input"
                                    type="text"
                                    placeholder="اكتب كلمة عربية..."
                                    class="w-full px-5 py-3 border-2 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-right text-lg pr-12"
                                    dir="rtl"
                                    lang="ar"
                                />
                                <button id="search-button" class="absolute inset-y-0 left-0 flex items-center pl-3 pr-2 rounded-full">
                                    <i class="fas fa-search text-gray-400"></i>
                                </button>
                            </div>
                        </div>
                        <div id="results-container" class="mt-8">
                            <!-- Results will be displayed here -->
                            ${state.content ? formatResults(state.content) : ''}
                        </div>
                    </div>
                `;

                // Add event listener to the search button and input field
                const searchButton = document.getElementById('search-button');
                const arabicInput = document.getElementById('arabic-input');
                searchButton.addEventListener('click', handleSearch);
                arabicInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleSearch();
                    }
                });
            }
        }

        // Function to format the JSON data into HTML
        function formatResults(data) {
            if (!data) return '';
            const { root_word, root_word_english, synonyms, antonyms, example_sentences, derivations, cultural_notes } = data;

            return `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-800">
                    <div>
                        <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Root Word</h3>
                        <div class="text-lg">
                            <p class="mb-1"><span class="font-semibold">Arabic:</span> ${root_word}</p>
                            <p><span class="font-semibold">English:</span> ${root_word_english}</p>
                        </div>
                    </div>
                    ${synonyms && synonyms.length > 0 ? `
                    <div>
                        <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Synonyms</h3>
                        <ul class="list-disc list-inside">
                            ${synonyms.map(s => `<li>${s.arabic} <span class="text-gray-500">(${s.english})</span></li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    ${antonyms && antonyms.length > 0 ? `
                    <div>
                        <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Antonyms</h3>
                        <ul class="list-disc list-inside">
                            ${antonyms.map(a => `<li>${a.arabic} <span class="text-gray-500">(${a.english})</span></li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                ${example_sentences && example_sentences.length > 0 ? `
                <div class="mt-8">
                    <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Example Sentences</h3>
                    <div class="space-y-4">
                        ${example_sentences.map(e => `
                            <div>
                                <p class="text-lg font-medium text-right" dir="rtl">${e.arabic}</p>
                                <p class="text-gray-600 pl-4">${e.english}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                ${derivations && derivations.length > 0 ? `
                <div class="mt-8">
                    <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Derived Forms</h3>
                    <ul class="list-disc list-inside">
                        ${derivations.map(d => `<li>${d.arabic} <span class="text-gray-500">(${d.english})</span></li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                ${cultural_notes ? `
                <div class="mt-8">
                    <h3 class="text-xl font-bold border-b-2 border-blue-200 pb-2 mb-4">Cultural Notes</h3>
                    <p class="text-gray-700 leading-relaxed">${cultural_notes}</p>
                </div>
                ` : ''}
            `;
        }

        // Function to handle the search logic and API call
        async function handleSearch() {
            const arabicWord = document.getElementById('arabic-input').value;
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

            if (!arabicWord) {
                state.error = "Please enter an Arabic word to search.";
                render();
                return;
            }

            // Set loading state and clear previous content
            state.loading = true;
            state.initialLoad = false;
            state.content = null;
            state.error = null;
            render();

            try {
                const prompt = `For the Arabic word '${arabicWord.trim()}', provide its root word and its English translation, a list of up to 5 synonyms with their English translations (if they are close enough in meaning), a list of up to 3 antonyms with their English translations (if they are opposite enough in meaning), three distinct example sentences using the word, each with its English translation.
                Additionally, provide up to 3 common derived forms or verb conjugations of the word with their English translations, and a brief paragraph (1-3 sentences) on its cultural context or specific usage nuances.
                Ensure the output is a JSON object with keys: \`root_word\` (string), \`root_word_english\` (string), \`synonyms\` (array of objects with 'arabic' and 'english' keys), \`antonyms\` (array of objects with 'arabic' and 'english' keys), \`example_sentences\` (array of objects with 'arabic' and 'english' keys), \`derivations\` (array of objects with 'arabic' and 'english' keys), and \`cultural_notes\` (string).`;
                
                const payload = {
                    "contents": [{ "parts": [{ "text": prompt }] }],
                    "generationConfig": {
                        "responseMimeType": "application/json"
                    }
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'API responded with an error.');
                }

                const geminiResponseData = await response.json();
                const generatedContent = geminiResponseData.candidates[0].content.parts[0].text;
                const data = JSON.parse(generatedContent);

                state.content = data;

            } catch (error) {
                console.error("Fetch error:", error);
                state.error = `Could not get data. Please check the word and try again. Error: ${error.message}`;
            } finally {
                state.loading = false;
                render();
            }
        }

        // Initial render on page load
        window.onload = function() {
            render();
        }
    </script>
</body>
</html>
